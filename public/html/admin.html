<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">




</head>

<body>
    <div class="sidebar">
        <div class="logo_content">
            <div class="logo-container">
                <img src="../assets/logoWhite.png" />
            </div>

            <i class="bi bi-list fs-3" id="btn"></i>
        </div>
        <ul class="nav_list">
            <li>
                <a href="#">
                    <i class="bi bi-person-circle"></i>
                    <span class="links_name">Th√¥ng tin c√° nh√¢n</span>
                </a>
                <span class="tooltip">Th√¥ng tin c√° nh√¢n</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bxs-bar-chart-square'></i>
                    <span class="links_name">Th·ªëng k√™ d·ªØ li·ªáu</span>
                </a>
                <span class="tooltip">Th·ªëng k√™ d·ªØ li·ªáu</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bxs-folder-open'></i>
                    <span class="links_name">Qu·∫£n l√Ω b√†i vi·∫øt</span>
                </a>
                <span class="tooltip">Qu·∫£n l√Ω b√†i vi·∫øt</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bxs-category-alt'></i>
                    <span class="links_name">Qu·∫£n l√Ω danh m·ª•c</span>
                </a>
                <span class="tooltip">Qu·∫£n l√Ω danh m·ª•c</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bxs-user'></i>
                    <span class="links_name">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</span>
                </a>
                <span class="tooltip">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bxs-comment-detail'></i>
                    <span class="links_name">Qu·∫£n l√Ω b√¨nh lu·∫≠n</span>
                </a>
                <span class="tooltip">Qu·∫£n l√Ω b√¨nh lu·∫≠n</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-log-out'></i>
                    <span class="links_name">Quay l·∫°i</span>
                </a>
                <span class="tooltip">Quay l·∫°i</span>
            </li>
        </ul>
    </div>


    <div class="home_content">
        <div id="infoManagement" class="info_management" style="display: none;">
            <h2 class="info_management-title">Th√¥ng tin c√° nh√¢n</h2>
            <div class="info_management-content">

                <!-- H·ªç v√† T√™n -->
                <div class="info_management-row">
                    <label class="info_management-label">H·ªç v√† T√™n:</label>
                    <div class="info_management-input-group">
                        <input type="text" id="info_management-name" class="info_management-input" value="Nguy·ªÖn VƒÉn A"
                            disabled>
                        <div class="info_management-button-group">
                            <button id="info_management-edit-name" class="info_management-button">‚úèÔ∏è</button>
                        </div>
                    </div>
                </div>

                <!-- Email (kh√¥ng ch·ªânh s·ª≠a, th√™m placeholder) -->
                <div class="info_management-row">
                    <label class="info_management-label">Email:</label>
                    <div class="info_management-input-group">
                        <input type="email" id="info_management-email" class="info_management-input"
                            value="nguyenvana@gmail.com" disabled>
                        <div class="info_management-email-placeholder"></div> <!-- Placeholder ƒë·ªÉ cƒÉn b·∫±ng -->
                    </div>
                </div>

                <!-- M·∫≠t kh·∫©u -->
                <div class="info_management-row">
                    <label class="info_management-label">M·∫≠t kh·∫©u:</label>
                    <div class="info_management-input-group">
                        <input type="password" id="info_management-password" class="info_management-input"
                            value="passwordcc" disabled>
                        <div class="info_management-button-group">
                            <button id="info_management-change-password" class="info_management-button">üîë</button>
                        </div>
                    </div>
                </div>

            </div>


        </div>



        <div id="staticManagement" class="static_management" style="display: none;">
            <h2>Th·ªëng k√™ d·ªØ li·ªáu</h2>
        </div>



        <div id="postManagement" class="post_management" style="display: none;">
            <h2>Qu·∫£n l√Ω b√†i vi·∫øt</h2>
            <div class="search-container">
                <div class="search-container-box">
                    <div class="search-box" id="search-box1">
                        <input type="text" placeholder="T√¨m ki·∫øm...">
                        <label class="search-icon" id="search-icon1">
                            <i class="bi bi-search"></i>
                        </label>
                    </div>
                </div>
                <button class="add-post-btn" id="addPostBtn">Th√™m b√†i b√°o</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ID b√†i b√°o</th>
                        <th>T√°c gi·∫£</th>
                        <th>T√™n ti√™u ƒë·ªÅ</th>
                        <th>T√™n danh m·ª•c</th>
                        <th>·∫¢nh b√¨a</th>
                        <th>N·ªôi dung b√†i b√°o</th>
                        <th>ƒê·ªãa ch·ªâ alias</th>
                        <th>S·ªë l∆∞·ª£t xem</th>
                        <th>S·ªë l∆∞·ª£t th√≠ch</th>
                        <th>N·ªïi b·∫≠t</th>
                        <th>Ng√†y ƒëƒÉng b√†i</th>
                        <th>H√†nh ƒë·ªông</th>
                        <th>Tr·∫°ng th√°i</th>
                    </tr>
                </thead>
                <tbody id="tbodyArticle"></tbody>
            </table>
            <div id="addPostModal" class="action-modal-overlay">
                <div class="action-modal-content">
                    <button class="action-modal-close">&times;</button>
                    <div class="action-modal-header">
                        <h2>Th√™m b√†i b√°o</h2>
                    </div>

                    <div class="action-form-group">
                        <label>T√™n B√†i b√°o</label>
                        <input type="text" placeholder="Nh·∫≠p t√™n b√†i b√°o">
                    </div>

                    <div class="action-form-group">
                        <label>T√°c gi·∫£</label>
                        <input type="text" placeholder="Nh·∫≠p t√™n t√°c gi·∫£">
                    </div>

                    <div class="action-form-group">
                        <label>Danh m·ª•c ch√≠nh</label>
                        <select id="mainCategory">
                            <option value="" disabled selected>Ch·ªçn danh m·ª•c ch√≠nh</option>
                            <option value="society">X√£ h·ªôi</option>
                            <option value="science">Khoa h·ªçc & C√¥ng ngh·ªá</option>
                            <option value="health">S·ª©c kh·ªèe</option>
                            <option value="sports">Th·ªÉ Thao</option>
                            <option value="entertainment">Gi·∫£i tr√≠</option>
                            <option value="education">Gi√°o d·ª•c</option>
                        </select>
                    </div>
                    <div class="action-form-group">
                        <label>Danh m·ª•c ph·ª•</label>
                        <select id="subCategory">
                            <option value="" disabled selected>Ch·ªçn danh m·ª•c ph·ª•</option>
                        </select>
                    </div>

                    <div class="action-form-group">
                        <label>·∫¢nh b√†i b√°o</label>
                        <input type="text" placeholder="Image">
                    </div>
                    <div class="action-form-group">
                        <label>Link b√†i b√°o</label>
                        <input type="text" placeholder="Link b√†i b√°o">
                    </div>

                    <div class=" action-form-group" style="grid-column: 1 / -1;">
                        <label>N·ªôi dung b√†i b√°o</label>
                        <textarea placeholder="Nh·∫≠p n·ªôi dung b√†i b√°o"></textarea>
                    </div>

                    <div class="action-modal-footer">
                        <button id="btnAddPost" class="btn-add">Th√™m b√†i b√°o</button>
                    </div>
                </div>
            </div>


            <div id="editPostModal" class="action-modal-overlay">
                <div class="action-modal-content" style="gap: 20px!important;">
                    <button class="action-modal-close">&times;</button>
                    <div class="action-modal-header">
                        <h2>Ch·ªânh s·ª≠a b√†i b√°o</h2>
                    </div>

                    <div class="action-form-group">
                        <label>T√™n B√†i b√°o</label>
                        <input type="text" id="editPostTitle" placeholder="Nh·∫≠p t√™n b√†i b√°o">
                    </div>

                    <div class="action-form-group">
                        <label>T√™n nh√† b√°o</label>
                        <input type="text" id="editPostAuthorId" placeholder="Nh·∫≠p t√™n nh√† b√°o">
                    </div>

                    <div class="action-form-group">
                        <label>Danh m·ª•c ch√≠nh</label>
                        <select id="editMainCategory">
                            <option value="" disabled selected>Ch·ªçn danh m·ª•c ch√≠nh</option>
                            <option value="society">X√£ h·ªôi</option>
                            <option value="science">Khoa h·ªçc & C√¥ng ngh·ªá</option>
                            <option value="health">S·ª©c kh·ªèe</option>
                            <option value="sports">Th·ªÉ Thao</option>
                            <option value="entertainment">Gi·∫£i tr√≠</option>
                            <option value="education">Gi√°o d·ª•c</option>
                        </select>
                    </div>

                    <div class="action-form-group">
                        <label>Danh m·ª•c ph·ª•</label>
                        <select id="editSubCategory">
                            <option value="" disabled selected>Ch·ªçn danh m·ª•c ph·ª•</option>
                        </select>
                    </div>

                    <div class="action-form-group">
                        <label>·∫¢nh</label>
                        <input type="text" id="editPostHeroImage" placeholder="Image">
                    </div>

                    <div class="action-form-group">
                        <label>Link b√†i b√°o</label>
                        <input type="text" id="editPostNameAlias" placeholder="Link b√†i b√°o">
                    </div>

                    <div class="action-form-group">
                        <label>N·ªïi b·∫≠t</label>
                        <select id="editIsFeatured">
                            <option value="false">Kh√¥ng</option>
                            <option value="true">C√≥</option>
                        </select>
                    </div>

                    <div class="action-form-group" style="grid-column: 1 / -1;">
                        <label>N·ªôi dung b√†i b√°o</label>
                        <textarea id="editPostContent" placeholder="Nh·∫≠p n·ªôi dung b√†i b√°o"></textarea>
                    </div>

                    <div class="action-modal-footer">
                        <button id="btnUpdatePost" class="btn-edit">C·∫≠p nh·∫≠t b√†i b√°o</button>
                    </div>
                </div>
            </div>

            <div id="deletePostModal" class="delete-modal">
                <div class="modal-content-deleteModal">
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i b√°o n√†y kh√¥ng?</p>
                    <div class="modal-buttons">
                        <button id="confirmDeleteArticle" class="btn-confirm">C√≥</button>
                        <button id="cancelDeleteArticle" class="btn-cancel">Kh√¥ng</button>
                    </div>
                </div>
            </div>


        </div>


        <div id="categoryManagement" class="category_management">
            <h2>Qu·∫£n l√Ω danh m·ª•c</h2>
            <div class="search-container">
                <div class="search-container-box">
                    <div class="search-box">
                        <input type="text" id="categorySearchInput" placeholder="T√¨m ki·∫øm...">
                        <label class="search-icon">
                            <i class="bi bi-search"></i>
                        </label>
                    </div>
                </div>
                <button class="add-category-btn">Th√™m danh m·ª•c</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ID danh m·ª•c</th>
                        <th>T√™n danh m·ª•c</th>
                        <th>T√™n alias</th>
                        <th>Danh m·ª•c cha</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="tbodyCategories">
                    <!-- D·ªØ li·ªáu danh m·ª•c s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                </tbody>
            </table>

            <!-- Modal th√™m danh m·ª•c -->
            <div id="addCategoryModal" class="action-modal-overlay">
                <div class="action-modal-content">
                    <button class="action-modal-close">&times;</button>
                    <div class="action-modal-header">
                        <h2>Th√™m danh m·ª•c</h2>
                    </div>

                    <div class="action-form-group">
                        <label>T√™n danh m·ª•c</label>
                        <input type="text" placeholder="Nh·∫≠p t√™n danh m·ª•c">
                    </div>

                    <div class="action-form-group">
                        <label>T√™n link</label>
                        <input type="text" placeholder="Nh·∫≠p link">
                    </div>

                    <div class="action-form-group">
                        <label>Danh m·ª•c cha</label>
                        <select id="mainCategory2">
                            <option>X√£ h·ªôi</option>
                            <option>Khoa h·ªçc & C√¥ng ngh·ªá</option>
                            <option>S·ª©c kh·ªèe</option>
                            <option>Th·ªÉ Thao</option>
                            <option>Gi·∫£i tr√≠</option>
                            <option>Gi√°o d·ª•c</option>
                        </select>
                    </div>

                    <div class="action-modal-footer">
                        <button class="btn-add">Th√™m danh m·ª•c</button>
                    </div>
                </div>
            </div>

            <!-- Modal ch·ªânh s·ª≠a danh m·ª•c -->
            <div id="editCategoryModal" class="action-modal-overlay">
                <div class="action-modal-content" style="margin-left: 22%;margin-top: 10%;">
                    <button class="action-modal-close">&times;</button>
                    <div class="action-modal-header">
                        <h2>Ch·ªânh s·ª≠a danh m·ª•c</h2>
                    </div>

                    <div class="action-form-group">
                        <label>T√™n danh m·ª•c</label>
                        <input type="text" id="editCategoryName" placeholder="Nh·∫≠p t√™n danh m·ª•c">
                    </div>

                    <div class="action-form-group">
                        <label>Link</label>
                        <input type="text" id="editCategoryLink" placeholder="Nh·∫≠p link">
                    </div>

                    <div class="action-form-group">
                        <label>Danh m·ª•c cha</label>
                        <select id="editParentCategory">
                            <!-- C√°c l·ª±a ch·ªçn kh√°c s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t ƒë·ªông t·ª´ API -->
                            <option>X√£ h·ªôi</option>
                            <option>Khoa h·ªçc & C√¥ng ngh·ªá</option>
                            <option>S·ª©c kh·ªèe</option>
                            <option>Th·ªÉ Thao</option>
                            <option>Gi·∫£i tr√≠</option>
                            <option>Gi√°o d·ª•c</option>
                        </select>
                    </div>

                    <div class="action-modal-footer">
                        <button id="btnUpdateCategory" class="btn-edit">C·∫≠p nh·∫≠t danh m·ª•c</button>
                    </div>
                </div>
            </div>

            <!-- Modal x√°c nh·∫≠n x√≥a -->
            <div id="deleteCategoryModal" class="delete-modal">
                <div class="modal-content-deleteModal">
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a danh m·ª•c n√†y kh√¥ng?</p>
                    <div class="modal-buttons">
                        <button id="confirmDeleteCate" class="btn-confirm">C√≥</button>
                        <button id="cancelDeleteCate" class="btn-cancel">Kh√¥ng</button>
                    </div>
                </div>
            </div>
        </div>


        <div id="userManagement" class="user_management" style="display: none;">
            <div class="section-card">
                <h2 class="section-title">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
                <div class="search-container">
                    <div class="search-container-box">
                        <div class="search-box">
                            <input type="text" placeholder="T√¨m ki·∫øm...">
                            <label class="search-icon1">
                                <i class="bi bi-search"></i>
                            </label>
                        </div>
                    </div>
                    <button class="btn-primary btn-add-user">
                        Th√™m ng∆∞·ªùi d√πng
                    </button>
                </div>
                <div class="table-responsive">
                    <table class="dashboard-table">
                        <thead>
                            <tr>
                                <th>ID ng∆∞·ªùi d√πng</th>
                                <th>H·ªç v√† t√™n</th>
                                <th>Email</th>
                                <th>M·∫≠t kh·∫©u</th>
                                <th>H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyUser">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="modal-container" style="display: none;">
                <div class="modal-overlay">
                    <div class="modal-content">
                        <button class="modal-close-btn">&times;</button>
                        <h2 class="modal-title">Th√™m ng∆∞·ªùi d√πng</h2>
                        <form id="addUserForm" class="modal-form">
                            <div>
                                <label>T√™n ng∆∞·ªùi d√πng</label>
                                <input type="text" name="tenNguoiDung" required placeholder="Nh·∫≠p t√™n ng∆∞·ªùi d√πng">
                            </div>
                            <div>
                                <label>Email</label>
                                <input type="email" name="email" required placeholder="Nh·∫≠p email">
                            </div>

                            <div>
                                <label>M·∫≠t kh·∫©u</label>
                                <input type="password" name="matKhau" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
                            </div>
                            <div class="form-submit-wrapper">
                                <button type="submit" class="modal-submit-btn">Th√™m ng∆∞·ªùi d√πng</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div id="deleteUserModal" class="delete-modal">
                <div class="modal-content-deleteModal">
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y kh√¥ng?</p>
                    <div class="modal-buttons">
                        <button id="confirmDelete" class="btn-confirm">C√≥</button>
                        <button id="cancelDelete" class="btn-cancel">Kh√¥ng</button>
                    </div>
                </div>
            </div>
        </div>


        <div id="commentManagement" class="comment_management" style="display: none;">
            <div class="section-card">
                <h2 class="section-title" style="margin-bottom: 70px;">Qu·∫£n l√Ω b√¨nh lu·∫≠n</h2>
                <div class="table-responsive">
                    <table class="dashboard-table">
                        <thead>
                            <tr>
                                <th>ID B√¨nh lu·∫≠n </th>
                                <th>ID Ng∆∞·ªùi d√πng </th>
                                <th>ID B√†i vi·∫øt</th>
                                <th>ID_parent</th>
                                <th>Ng√†y b√¨nh lu·∫≠n</th>
                                <th>N·ªôi dung b√¨nh lu·∫≠n </th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>S·ªë l∆∞·ª£t th√≠ch</th>
                                <th>H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>4</td>
                                <td>12/03/2025</td>
                                <td>·∫£o ma canada</td>
                                <td>ƒê√£ duy·ªát</td>
                                <td>12</td>

                                <!-- <td>
                                    <span class="comment-status pending">Ch∆∞a duy·ªát</span>
                                </td> -->
                                <td>
                                    <div class="action-group">
                                        <button class="Comment-btn-delete"><i class="bi bi-trash"></i> X√≥a</button>

                                        <!-- <button class="btn-action btn-approve">
                                            <i class="bi bi-check-circle"></i> Duy·ªát
                                        </button> -->
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>4</td>
                                <td>12/03/2025</td>
                                <td>·∫£o ma canada</td>
                                <td>ƒê√£ duy·ªát</td>
                                <td>12</td>
                                <!-- <td>
                                    <span class="comment-status pending">Ch∆∞a duy·ªát</span>
                                </td> -->
                                <td>
                                    <div class="action-group">
                                        <button class="Comment-btn-delete"><i class="bi bi-trash"></i> X√≥a</button>

                                        <!-- <button class="btn-action btn-approve">
                                            <i class="bi bi-check-circle"></i> Duy·ªát
                                        </button> -->


                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="deleteCommentModal" class="delete-modal">
                <div class="modal-content-deleteModal">
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√¨nh lu·∫≠n n√†y kh√¥ng?</p>
                    <div class="modal-buttons">
                        <button id="confirmDelete" class="btn-confirm">C√≥</button>
                        <button id="cancelDelete" class="btn-cancel">Kh√¥ng</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const categoriesMap = {
            'society': ['Th·ªùi s·ª±', 'Giao th√¥ng', 'M√¥i tr∆∞·ªùng-Kh√≠ h·∫≠u'],
            'science': ['Tin t·ª©c c√¥ng ngh·ªá', 'Ho·∫°t ƒë·ªông c√¥ng ngh·ªá', 'T·∫°p ch√≠'],
            'health': ['Dinh d∆∞·ª°ng', 'L√†m ƒë·∫πp', 'Y t·∫ø'],
            'sports': ['B√≥ng ƒë√°', 'B√≥ng r·ªï'],
            'entertainment': ['√Çm nh·∫°c', 'Th·ªùi trang', 'ƒêi·ªán ·∫£nh-Truy·ªÅn h√¨nh'],
            'education': ['Thi c·ª≠', 'ƒê√†o t·∫°o', 'H·ªçc b·ªïng-Du h·ªçc']
        };

        // Mapping t·ª´ danh m·ª•c ph·ª• sang ID danh m·ª•c
        const categoryToIdMap = {
            'Th·ªùi s·ª±': 'society-news',
            'Giao th√¥ng': 'society-transport',
            'M√¥i tr∆∞·ªùng-Kh√≠ h·∫≠u': 'society-environment',
            'Tin t·ª©c c√¥ng ngh·ªá': 'science-news',
            'Ho·∫°t ƒë·ªông c√¥ng ngh·ªá': 'science-activity',
            'T·∫°p ch√≠': 'science-magazine',
            'Dinh d∆∞·ª°ng': 'health-nutrition',
            'L√†m ƒë·∫πp': 'health-beauty',
            'Y t·∫ø': 'health-medical',
            'B√≥ng ƒë√°': 'sports-football',
            'B√≥ng r·ªï': 'sports-basketball',
            '√Çm nh·∫°c': 'entertainment-music',
            'Th·ªùi trang': 'entertainment-fashion',
            'ƒêi·ªán ·∫£nh-Truy·ªÅn h√¨nh': 'entertainment-movie',
            'Thi c·ª≠': 'education-exam',
            'ƒê√†o t·∫°o': 'education-training',
            'H·ªçc b·ªïng-Du h·ªçc': 'education-scholarship'
        };

        // Mapping ng∆∞·ª£c t·ª´ danh m·ª•c ph·ª• sang ch√≠nh
        const mainCategoryFromSubMap = {
            'Th·ªùi s·ª±': 'society',
            'Giao th√¥ng': 'society',
            'M√¥i tr∆∞·ªùng-Kh√≠ h·∫≠u': 'society',
            'Tin t·ª©c c√¥ng ngh·ªá': 'science',
            'Ho·∫°t ƒë·ªông c√¥ng ngh·ªá': 'science',
            'T·∫°p ch√≠': 'science',
            'Dinh d∆∞·ª°ng': 'health',
            'L√†m ƒë·∫πp': 'health',
            'Y t·∫ø': 'health',
            'B√≥ng ƒë√°': 'sports',
            'B√≥ng r·ªï': 'sports',
            '√Çm nh·∫°c': 'entertainment',
            'Th·ªùi trang': 'entertainment',
            'ƒêi·ªán ·∫£nh-Truy·ªÅn h√¨nh': 'entertainment',
            'Thi c·ª≠': 'education',
            'ƒê√†o t·∫°o': 'education',
            'H·ªçc b·ªïng-Du h·ªçc': 'education'
        };
        /**
         * Ti·ªán √≠ch ph√¢n trang t√°i s·ª≠ d·ª•ng cho nhi·ªÅu API fetch
         */
        const PaginationUtils = {
            // L∆∞u tr·ªØ tr·∫°ng th√°i ph√¢n trang
            states: {},

            /**
             * Kh·ªüi t·∫°o ph√¢n trang cho m·ªôt b·∫£ng
             * @param {string} tableId - ID duy nh·∫•t cho b·∫£ng
             * @param {Object} config - C·∫•u h√¨nh
             * @returns {Object} - Tr·∫°ng th√°i ph√¢n trang
             */
            init(tableId, config = {}, force = false) {
                const defaultConfig = {
                    pageSize: 10,
                    sortField: null,
                    sortOrder: 'asc',
                    visiblePages: 10
                };

                if (!this.states[tableId] || force) {
                    this.states[tableId] = {
                        ...defaultConfig,
                        ...config,
                        currentPage: 1,
                        totalItems: 0,
                        totalPages: 0
                    };
                }

                return this.states[tableId];
            },
            reset(tableId, keepConfig = true) {
                if (!this.states[tableId]) return;

                const currentConfig = keepConfig ? {
                    pageSize: this.states[tableId].pageSize,
                    sortField: this.states[tableId].sortField,
                    sortOrder: this.states[tableId].sortOrder,
                    visiblePages: this.states[tableId].visiblePages
                } : {};

                // Reset v·ªÅ trang 1 v√† gi·ªØ nguy√™n config n·∫øu c·∫ßn
                this.states[tableId] = {
                    ...currentConfig,
                    currentPage: 1,
                    totalItems: 0,
                    totalPages: 0
                };
            },

            /**
             * C·∫≠p nh·∫≠t t·ªïng s·ªë items
             * @param {string} tableId 
             * @param {number} totalItems 
             */
            setTotalItems(tableId, totalItems) {
                const state = this.getState(tableId);
                state.totalItems = totalItems;
                state.totalPages = Math.ceil(totalItems / state.pageSize) || 1;

                // ƒê·∫£m b·∫£o currentPage kh√¥ng v∆∞·ª£t qu√° totalPages
                if (state.currentPage > state.totalPages) {
                    state.currentPage = state.totalPages;
                }
            },

            /**
             * L·∫•y tr·∫°ng th√°i hi·ªán t·∫°i
             * @param {string} tableId 
             * @returns {Object}
             */
            getState(tableId) {
                if (!this.states[tableId]) {
                    console.warn(`Pagination state for ${tableId} not found, initializing with default config`);
                    return this.init(tableId);
                }
                return this.states[tableId];
            },

            /**
             * Chuy·ªÉn ƒë·∫øn trang c·ª• th·ªÉ
             * @param {string} tableId 
             * @param {number} page 
             * @param {Function} callback 
             * @returns {boolean} - Th√†nh c√¥ng hay kh√¥ng
             */
            goToPage(tableId, page, callback) {
                const state = this.getState(tableId);

                if (page < 1 || page > state.totalPages || page === state.currentPage) {
                    return false;
                }

                state.currentPage = page;
                if (typeof callback === 'function') {
                    callback(state);
                }
                return true;
            },

            /**
             * L·∫•y d·ªØ li·ªáu cho trang hi·ªán t·∫°i
             * @param {string} tableId 
             * @param {Array} data 
             * @returns {Array}
             */
            getPageData(tableId, data) {
                const safeData = Array.isArray(data) ? data : []
                const state = this.getState(tableId);
                const start = (state.currentPage - 1) * state.pageSize;
                const end = start + state.pageSize;

                // S·∫Øp x·∫øp d·ªØ li·ªáu n·∫øu c√≥ y√™u c·∫ßu
                if (state.sortField) {
                    data = [...data].sort((a, b) => {
                        const valA = a[state.sortField];
                        const valB = b[state.sortField];

                        if (typeof valA === 'string' && typeof valB === 'string') {
                            return state.sortOrder === 'asc'
                                ? valA.localeCompare(valB)
                                : valB.localeCompare(valA);
                        }

                        return state.sortOrder === 'asc'
                            ? (valA > valB ? 1 : -1)
                            : (valA < valB ? 1 : -1);
                    });
                }

                return safeData.slice(start, end);
            },

            /**
             * Render UI ph√¢n trang
             * @param {string} tableId 
             * @param {string} containerId 
             * @param {Function} onChange 
             */
            render(tableId, containerId, onChange) {
                const state = this.getState(tableId);
                const container = document.getElementById(containerId);

                if (!container) {
                    console.error(`Container #${containerId} not found`);
                    return;
                }

                // T·∫°o HTML
                container.innerHTML = this.generatePaginationHTML(tableId, state);

                // G·∫Øn s·ª± ki·ªán
                this.bindEvents(tableId, containerId, onChange);
            },
            getVisiblePages(currentPage, totalPages, visiblePages = 5) {
                // N·∫øu t·ªïng s·ªë trang √≠t h∆°n s·ªë trang mu·ªën hi·ªÉn th·ªã, hi·ªÉn th·ªã t·∫•t c·∫£
                if (totalPages <= visiblePages) {
                    return Array.from({ length: totalPages }, (_, i) => i + 1);
                }

                // T√≠nh to√°n ph·∫°m vi trang hi·ªÉn th·ªã
                let startPage = Math.max(1, currentPage - Math.floor(visiblePages / 2));
                let endPage = startPage + visiblePages - 1;

                // ƒêi·ªÅu ch·ªânh n·∫øu v∆∞·ª£t qu√° t·ªïng s·ªë trang
                if (endPage > totalPages) {
                    endPage = totalPages;
                    startPage = Math.max(1, endPage - visiblePages + 1);
                }

                // T·∫°o m·∫£ng c√°c trang c·∫ßn hi·ªÉn th·ªã
                return Array.from({ length: endPage - startPage + 1 }, (_, i) => startPage + i);
            },
            /**
             * T·∫°o HTML cho ph√¢n trang
             * @param {string} tableId 
             * @param {Object} state 
             * @returns {string}
             */
            generatePaginationHTML(tableId, state) {
                const pages = this.getVisiblePages(state.currentPage, state.totalPages, state.visiblePages);

                return `
        <div class="pagination-container">
            <div class="pagination-info">
                Hi·ªÉn th·ªã ${Math.min((state.currentPage - 1) * state.pageSize + 1, state.totalItems)} - 
                ${Math.min(state.currentPage * state.pageSize, state.totalItems)} 
                / ${state.totalItems} m·ª•c
            </div>
            
            <div class="pagination-controls">
                <button class="pagination-btn first-page" ${state.currentPage === 1 ? 'disabled' : ''}>
                    <i class="bi bi-chevron-double-left"></i>
                </button>
                
                <button class="pagination-btn prev-page" ${state.currentPage === 1 ? 'disabled' : ''}>
                    <i class="bi bi-chevron-left"></i>
                </button>
                
                ${pages.map(page => `
                    <button class="pagination-btn page-number ${state.currentPage === page ? 'active' : ''}">
                        ${page}
                    </button>
                `).join('')}
                
                <button class="pagination-btn next-page" ${state.currentPage === state.totalPages ? 'disabled' : ''}>
                    <i class="bi bi-chevron-right"></i>
                </button>
                
                <button class="pagination-btn last-page" ${state.currentPage === state.totalPages ? 'disabled' : ''}>
                    <i class="bi bi-chevron-double-right"></i>
                </button>
            </div>
        </div>
    `;
            }

            /**
             * T√≠nh c√°c trang s·∫Ω hi·ªÉn th·ªã
             * @param {number} current 
             * @param {number} total 
             * @param {number} visible 
             * @returns {Array}
             */
            /**
             * G·∫Øn s·ª± ki·ªán cho c√°c n√∫t
             * @param {string} tableId 
             * @param {string} containerId 
             * @param {Function} onChange 
             */
            ,
            bindEvents(tableId, containerId, onChange) {
                const container = document.getElementById(containerId);
                const state = this.getState(tableId);

                // C√°c n√∫t ƒëi·ªÅu h∆∞·ªõng
                container.querySelector('.first-page')?.addEventListener('click', () => {
                    this.handlePageChange(tableId, containerId, 1, onChange);
                });

                container.querySelector('.prev-page')?.addEventListener('click', () => {
                    this.handlePageChange(tableId, containerId, state.currentPage - 1, onChange);
                });

                container.querySelector('.next-page')?.addEventListener('click', () => {
                    this.handlePageChange(tableId, containerId, state.currentPage + 1, onChange);
                });

                container.querySelector('.last-page')?.addEventListener('click', () => {
                    this.handlePageChange(tableId, containerId, state.totalPages, onChange);
                });

                // C√°c n√∫t trang s·ªë
                container.querySelectorAll('.page-number').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const page = parseInt(btn.textContent);
                        this.handlePageChange(tableId, containerId, page, onChange);
                    });
                });

                // ƒê√£ b·ªè ph·∫ßn x·ª≠ l√Ω thay ƒë·ªïi s·ªë item m·ªói trang
            },

            /**
             * X·ª≠ l√Ω thay ƒë·ªïi trang
             * @param {string} tableId 
             * @param {string} containerId 
             * @param {number} page 
             * @param {Function} callback 
             */
            handlePageChange(tableId, containerId, page, callback) {
                if (this.goToPage(tableId, page, callback)) {
                    this.render(tableId, containerId, callback);
                }
            },

            /**
             * Th√™m CSS v√†o trang
             */
            injectStyles() {
                if (document.getElementById('pagination-styles')) return;

                const style = document.createElement('style');
                style.id = 'pagination-styles';
                style.textContent = `
        .pagination-container {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 1rem;
            padding: 0.5rem;
            font-family: Arial, sans-serif;
        }
        
        .pagination-info {
            color: #555;
            font-size: 0.9rem;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .pagination-controls {
            display: flex;
            gap: 0.3rem;
            margin-right: auto; /* ƒê·∫©y sang tr√°i */
        }
        
        .pagination-btn {
            min-width: 2rem;
            height: 2rem;
            padding: 0 0.5rem;
            border: 1px solid #dee2e6;
            background-color: #f8f9fa;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pagination-btn:hover:not([disabled]) {
            background-color: #e9ecef;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-btn.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        /* Th√™m wrapper ƒë·ªÉ cƒÉn ch·ªânh layout */
        .pagination-wrapper {
            display: flex;
            width: 100%;
            position: relative;
        }
    `;
                document.head.appendChild(style);
            },

        }
        // T·ª± ƒë·ªông th√™m CSS khi load
        PaginationUtils.injectStyles();

        // 1. H√†m l·∫•y danh s√°ch b√†i vi·∫øt c√≥ ph√¢n trang (c√≥ th·ªÉ nh·∫≠n tham s·ªë t√¨m ki·∫øm)
        async function fetchArticles(searchParams = {}) {
            try {
                let url = "http://localhost:3000/api/articles";

                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // L∆∞u t·∫•t c·∫£ b√†i vi·∫øt v√†o bi·∫øn to√†n c·ª•c ƒë·ªÉ d·ªÖ d√†ng ph√¢n trang
                allArticles = await response.json();

                // Kh·ªüi t·∫°o ho·∫∑c c·∫≠p nh·∫≠t ph√¢n trang
                const tableId = "articleTable";

                // N·∫øu l√† l·∫ßn ƒë·∫ßu th√¨ kh·ªüi t·∫°o, 
                PaginationUtils.init(tableId, {
                    pageSize: 4,
                    sortField: "id_article",
                    sortOrder: "asc",
                    visiblePages: 4
                });

                PaginationUtils.reset(tableId); // Th√™m h√†m reset n·∫øu ch∆∞a c√≥
                PaginationUtils.setTotalItems(tableId, allArticles.length);

                const currentPageData = PaginationUtils.getPageData(tableId, allArticles);
                renderArticles(currentPageData);

                // 6. Render l·∫°i ph√¢n trang
                PaginationUtils.render(tableId, "articlePagination", (state) => {
                    const pageData = PaginationUtils.getPageData(tableId, allArticles);
                    renderArticles(pageData);
                });
            } catch (error) {
                console.error("Error fetching articles:", error);
                alert("L·ªói khi t·∫£i d·ªØ li·ªáu: " + error.message);
            }
        }

        // H√†m render b√†i vi·∫øt t·ª´ d·ªØ li·ªáu ƒë√£ ph√¢n trang
        function renderArticles(articles) {
            const tableBody = document.getElementById("tbodyArticle");
            tableBody.innerHTML = ""; // X√≥a d·ªØ li·ªáu c≈©
            articles.forEach(article => {
                const row = `<tr>
            <td>${article.id_article}</td>
            <td><div class="ellipsis-text">${article.username}</div></td>
            <td><div class="ellipsis-text">${article.heading}</div></td>
            <td><div class="ellipsis-text">${article.parent_category_name || "None"}, ${article.category_name}</div></td>
            <td><div class="ellipsis-url">${article.hero_image}</div></td>
            <td><div class="ellipsis-text">${article.content}</div></td>
            <td><div class="ellipsis-text">${article.name_alias || ''}</div></td>
            <td>${article.views || 0}</td>
            <td>${article.like_count || 0}</td>
            <td>${article.is_featured ? "C√≥" : "Kh√¥ng"}</td>
            <td>${new Date(article.day_created).toLocaleDateString()}</td>
            <td class="actions-button">
                <button class="Post-btn-edit"><i class="bi bi-pencil-square"></i> Ch·ªânh s·ª≠a</button>
                <button class="Post-btn-delete" data-id="${article.id_article}"><i class="bi bi-trash"></i> X√≥a</button>
            </td>
            <td class="actions-button">
                <button class="Post-btn-approve" style='margin-left: 15%' data-id="${article.id_article}"><input type='checkbox'></button>
            </td>
        </tr>`;
                tableBody.innerHTML += row;
            });

            // G·∫Øn l·∫°i s·ª± ki·ªán cho n√∫t ch·ªânh s·ª≠a
            document.querySelectorAll(".Post-btn-edit").forEach(button => {
                attachEditButtonEvents(button);
            });
        }
        // 2. H√†m th√™m b√†i vi·∫øt m·ªõi
        async function addNewArticle(postData) {
            try {
                const response = await fetch('http://localhost:3000/api/articles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(postData)
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'Kh√¥ng th·ªÉ th√™m b√†i vi·∫øt m·ªõi');
                }
                fetchArticles();
                return result;
            } catch (error) {
                console.error("Error adding article:", error);
                throw error;
            }
        }

        // 3. H√†m c·∫≠p nh·∫≠t b√†i vi·∫øt
        async function updateArticle(articleId, updateData) {
            try {
                const response = await fetch(`http://localhost:3000/api/articles/${articleId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                const contentType = response.headers.get('content-type');
                if (!contentType?.includes('application/json')) {
                    const text = await response.text();
                    throw new Error(text || 'Invalid server response');
                }

                const result = await response.json();

                if (!response.ok) {
                    // X·ª≠ l√Ω c√°c lo·∫°i l·ªói c·ª• th·ªÉ
                    const errorMap = {
                        'USER_NOT_FOUND': 'Ng∆∞·ªùi d√πng kh√¥ng t·ªìn t·∫°i',
                        'CATEGORY_NOT_FOUND': 'Danh m·ª•c kh√¥ng t·ªìn t·∫°i',
                        'SERVER_ERROR': 'L·ªói h·ªá th·ªëng'
                    };
                    throw new Error(errorMap[result.error] || result.message || 'C·∫≠p nh·∫≠t th·∫•t b·∫°i');
                }
                fetchArticles();
                return result;
            } catch (error) {
                console.error("Error updating article:", error);
                throw error;
            }
        }

        async function deleteArticle(articleId) {
            try {
                const response = await fetch(`http://localhost:3000/api/articles/${articleId}`, {
                    method: 'DELETE',
                    headers: { 'Accept': 'application/json' }
                });

                const data = await response.json();

                if (!response.ok) {
                    // X·ª≠ l√Ω ri√™ng tr∆∞·ªùng h·ª£p 404
                    if (response.status === 404) {
                        return { success: false, message: "B√†i vi·∫øt kh√¥ng t·ªìn t·∫°i" }; // ‚úÖ Th√¥ng b√°o th√¢n thi·ªán
                    }
                    throw new Error(data.error || "X√≥a th·∫•t b·∫°i");
                }
                fetchArticles();
                return { success: true, message: "X√≥a th√†nh c√¥ng" };
            } catch (error) {
                console.error("L·ªói khi x√≥a b√†i vi·∫øt:", error);
                return { success: false, message: "L·ªói h·ªá th·ªëng" }; // X·ª≠ l√Ω l·ªói kh√°c (500, network...)
            }
        }

        // 1. Kh·ªüi t·∫°o s·ª± ki·ªán cho form th√™m b√†i vi·∫øt m·ªõi
        function initializeAddEvents() {
            const addPostModal = document.getElementById("addPostModal");
            const addPostBtn = document.getElementById("addPostBtn"); // Gi·∫£ s·ª≠ c√≥ n√∫t n√†y
            const closeModalBtn = addPostModal.querySelector(".action-modal-close");
            const addPostForm = addPostModal.querySelector(".action-modal-content");
            const btnAdd = addPostModal.querySelector(".btn-add");

            // C√°c ph·∫ßn t·ª≠ form
            const addPostTitle = addPostModal.querySelector('input[type="text"]:first-of-type');
            const addPostAuthor = document.querySelector('input[placeholder="Nh·∫≠p t√™n t√°c gi·∫£"]')
            const mainCategorySelect = document.getElementById("mainCategory");
            const subCategorySelect = document.getElementById("subCategory");
            const addPostHeroImage = addPostModal.querySelector('input[placeholder="Image"]');
            const addPostLink = addPostModal.querySelector('input[placeholder="Link b√†i b√°o"]');
            const addPostContent = addPostModal.querySelector('textarea');


            // M·ªü modal
            addPostBtn.addEventListener("click", () => {
                addPostModal.style.display = "flex";
            });

            // ƒê√≥ng modal
            closeModalBtn.addEventListener("click", () => {
                addPostModal.style.display = "none";
            });

            // ƒê√≥ng khi click b√™n ngo√†i
            addPostModal.addEventListener("click", (e) => {
                if (e.target === addPostModal) {
                    addPostModal.style.display = "none";
                }
            });

            // X·ª≠ l√Ω khi ch·ªçn danh m·ª•c ch√≠nh
            mainCategorySelect.addEventListener("change", function () {
                const mainCategory = this.value;
                subCategorySelect.innerHTML = '<option value="" disabled selected>Ch·ªçn danh m·ª•c ph·ª•</option>';

                if (mainCategory && categoriesMap[mainCategory]) {
                    categoriesMap[mainCategory].forEach(sub => {
                        const option = document.createElement('option');
                        option.value = sub;
                        option.textContent = sub;
                        subCategorySelect.appendChild(option);
                    });
                }
            });

            // X·ª≠ l√Ω th√™m b√†i vi·∫øt m·ªõi
            const btnAddPost = document.getElementById("btnAddPost");
            btnAddPost.addEventListener("click", async function () {
                if (!addPostTitle.value ||
                    !addPostAuthor.value ||
                    !mainCategorySelect.value ||
                    !subCategorySelect.value ||
                    !addPostContent.value) {
                    throw new Error("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc");
                }
                console.log(addPostAuthor.value, subCategorySelect.value, addPostTitle.value, addPostHeroImage.value || '', addPostContent.value, addPostLink.value);
                const postData = {
                    user: addPostAuthor.value,
                    category_name: subCategorySelect.value,
                    heading: addPostTitle.value,
                    hero_image: addPostHeroImage.value || '',
                    content: addPostContent.value,
                    name_alias: addPostLink.value || '',
                    is_featured: 'Kh√¥ng' // M·∫∑c ƒë·ªãnh kh√¥ng n·ªïi b·∫≠t khi th√™m m·ªõi
                };

                try {
                    await addNewArticle(postData);
                    alert("Th√™m b√†i vi·∫øt m·ªõi th√†nh c√¥ng!");

                    // Reset form
                    addPostTitle.value = '';
                    addPostAuthor.value = '';
                    mainCategorySelect.value = '';
                    subCategorySelect.innerHTML = '<option value="" disabled selected>Ch·ªçn danh m·ª•c ph·ª•</option>';
                    addPostHeroImage.value = '';
                    addPostLink.value = '';
                    addPostContent.value = '';

                    // ƒê√≥ng modal v√† t·∫£i l·∫°i danh s√°ch
                    addPostModal.style.display = "none";
                    fetchArticles();
                } catch (error) {
                    alert(`L·ªói: ${error.message}`);
                }
            });
        }

        // 2. Kh·ªüi t·∫°o s·ª± ki·ªán cho form ch·ªânh s·ª≠a b√†i vi·∫øt
        function initializeEditEvents() {
            const editPostModal = document.getElementById("editPostModal");
            const btnUpdatePost = document.getElementById("btnUpdatePost");

            if (!editPostModal || !btnUpdatePost) {
                console.error("Kh√¥ng t√¨m th·∫•y c√°c ph·∫ßn t·ª≠ c·∫ßn thi·∫øt cho form ch·ªânh s·ª≠a");
                return;
            }

            const closeModalBtn = editPostModal.querySelector(".action-modal-close");
            const editPostTitle = document.getElementById("editPostTitle");
            const editPostAuthorId = document.getElementById("editPostAuthorId");
            const editMainCategory = document.getElementById("editMainCategory");
            const editSubCategory = document.getElementById("editSubCategory");
            const editPostHeroImage = document.getElementById("editPostHeroImage");
            const editPostNameAlias = document.getElementById("editPostNameAlias");
            const editPostContent = document.getElementById("editPostContent");
            const editIsFeatured = document.getElementById("editIsFeatured");

            // X·ª≠ l√Ω khi thay ƒë·ªïi danh m·ª•c ch√≠nh
            if (editMainCategory) {
                editMainCategory.addEventListener('change', function () {
                    const selectedMainCategory = this.value;
                    if (editSubCategory) {
                        editSubCategory.innerHTML = '<option value="" disabled selected>Ch·ªçn danh m·ª•c ph·ª•</option>';

                        if (selectedMainCategory && categoriesMap[selectedMainCategory]) {
                            categoriesMap[selectedMainCategory].forEach(category => {
                                const option = document.createElement('option');
                                option.value = category;
                                option.textContent = category;
                                editSubCategory.appendChild(option);
                            });
                        }
                    }
                });
            }

            // ƒê√≥ng modal ch·ªânh s·ª≠a
            closeModalBtn.addEventListener("click", function () {
                editPostModal.style.display = "none";
                const editingRow = document.querySelector("table tbody tr.editing-row");
                if (editingRow) {
                    editingRow.classList.remove('editing-row');
                }
            });

            // X·ª≠ l√Ω c·∫≠p nh·∫≠t b√†i vi·∫øt
            btnUpdatePost.addEventListener("click", async function () {
                const row = document.querySelector("table tbody tr.editing-row");
                if (row) {
                    const cells = row.getElementsByTagName('td');
                    const articleId = cells[0].textContent;
                    const viewCount = parseInt(cells[7].textContent) || 0;
                    const likeCount = parseInt(cells[8].textContent) || 0;
                    console.log(editIsFeatured.value.trim())
                    const updateData = {
                        user: editPostAuthorId.value.trim(), // Th√™m trim() ƒë·ªÉ lo·∫°i b·ªè kho·∫£ng tr·∫Øng th·ª´a
                        category_name: editSubCategory.value.trim(), // ƒê·ªïi t·ª´ categoryId sang category_name ƒë·ªÉ ph√π h·ª£p v·ªõi API
                        heading: editPostTitle.value.trim(),
                        hero_image: editPostHeroImage.value.trim(),
                        content: editPostContent.value,
                        name_alias: editPostNameAlias.value.trim() || null, // D√πng null thay v√¨ chu·ªói r·ªóng
                        view: parseInt(viewCount) || 0, // ƒê·∫£m b·∫£o l√† s·ªë
                        likes: parseInt(likeCount) || 0, // ƒê·∫£m b·∫£o l√† s·ªë
                        is_featured: editIsFeatured.value.trim()
                    };

                    try {
                        await updateArticle(articleId, updateData);
                        alert("C·∫≠p nh·∫≠t b√†i vi·∫øt th√†nh c√¥ng!");
                        fetchArticles();
                    } catch (error) {
                        alert(`L·ªói: ${error.message}`);
                    }

                    row.classList.remove('editing-row');
                    editPostModal.style.display = "none";
                }
            });
        }

        // 3. Kh·ªüi t·∫°o s·ª± ki·ªán x√≥a b√†i vi·∫øt
        function initializeDeleteEvents() {
            const deletePostModal = document.getElementById("deletePostModal");
            const confirmDeleteBtn = document.getElementById("confirmDeleteArticle");
            const cancelDeleteBtn = document.getElementById("cancelDeleteArticle");

            if (!deletePostModal || !confirmDeleteBtn || !cancelDeleteBtn) {
                console.error("Kh√¥ng t√¨m th·∫•y c√°c ph·∫ßn t·ª≠ c·∫ßn thi·∫øt cho modal x√≥a");
                return;
            }

            // S·ª≠ d·ª•ng event delegation cho n√∫t x√≥a
            document.addEventListener('click', function (e) {
                if (e.target && e.target.closest('.Post-btn-delete')) {
                    const button = e.target.closest('.Post-btn-delete');
                    const articleId = button.getAttribute('data-id');

                    // Hi·ªÉn th·ªã modal x√°c nh·∫≠n
                    deletePostModal.style.display = "flex";

                    // X·ª≠ l√Ω khi x√°c nh·∫≠n x√≥a
                    confirmDeleteBtn.onclick = function () {
                        deleteArticle(articleId).then(() => {
                            deletePostModal.style.display = "none";
                        });
                    };

                    // X·ª≠ l√Ω khi h·ªßy x√≥a
                    cancelDeleteBtn.onclick = function () {
                        deletePostModal.style.display = "none";
                    };
                }
            });
        }

        // 4. H√†m g·∫Øn s·ª± ki·ªán cho n√∫t ch·ªânh s·ª≠a
        function attachEditButtonEvents(button) {
            button.addEventListener("click", function () {
                const editPostModal = document.getElementById("editPostModal");
                const row = this.closest("tr");
                const cells = row.getElementsByTagName('td');

                // ƒêi·ªÅn d·ªØ li·ªáu v√†o form ch·ªânh s·ª≠a
                document.getElementById("editPostTitle").value = cells[2].textContent;
                document.getElementById("editPostAuthorId").value = cells[1].textContent;
                document.getElementById("editPostContent").value = cells[5].textContent;
                document.getElementById("editPostHeroImage").value = cells[4].textContent;
                document.getElementById("editPostNameAlias").value = cells[6].textContent;

                // X·ª≠ l√Ω tr·∫°ng th√°i n·ªïi b·∫≠t
                const isFeaturedValue = cells[9].textContent;
                document.getElementById("editIsFeatured").value = isFeaturedValue === "C√≥" ? "true" : "false";

                // X·ª≠ l√Ω danh m·ª•c
                const categoryText = cells[3].textContent;
                const categories = categoryText.split(',');
                const subCategory = categories[1].trim();

                // Set danh m·ª•c ch√≠nh
                const editMainCategory = document.getElementById("editMainCategory");
                editMainCategory.value = mainCategoryFromSubMap[subCategory] || '';

                // Trigger change event ƒë·ªÉ load danh m·ª•c ph·ª•
                const event = new Event('change');
                editMainCategory.dispatchEvent(event);

                // Set danh m·ª•c ph·ª• sau khi options ƒë√£ ƒë∆∞·ª£c load
                setTimeout(() => {
                    document.getElementById("editSubCategory").value = subCategory;
                }, 50);

                // ƒê√°nh d·∫•u d√≤ng ƒëang ch·ªânh s·ª≠a
                row.classList.add('editing-row');
                editPostModal.style.display = "flex";
            });
        }
        // Kh·ªüi t·∫°o trang
        document.addEventListener("DOMContentLoaded", function () {
            initializeAddEvents();
            initializeEditEvents();
            initializeDeleteEvents();
            fetchArticles();

            // T·∫°o container cho ph√¢n trang n·∫øu ch∆∞a c√≥
            if (!document.getElementById("articlePagination")) {
                const paginationContainer = document.createElement("div");
                paginationContainer.id = "articlePagination";
                // Th√™m v√†o sau b·∫£ng
                const articleTable = document.querySelector("table");
                articleTable.parentNode.insertBefore(paginationContainer, articleTable.nextSibling);
            }
        });

        // 1. H√†m l·∫•y danh s√°ch danh m·ª•c v·ªõi ph√¢n trang
        async function fetchCategories() {
            try {
                const response = await fetch("http://localhost:3000/api/categories");
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                // L∆∞u t·∫•t c·∫£ danh m·ª•c v√†o bi·∫øn to√†n c·ª•c
                const categories = await response.json();
                window.categoriesData = categories; // ƒê·∫£m b·∫£o l∆∞u d·ªØ li·ªáu v√†o bi·∫øn to√†n c·ª•c

                // Kh·ªüi t·∫°o ho·∫∑c c·∫≠p nh·∫≠t ph√¢n trang
                const tableId = "categoryTable";

                // Reset ph√¢n trang tr∆∞·ªõc khi kh·ªüi t·∫°o l·∫°i
                PaginationUtils.reset(tableId);

                // N·∫øu l√† l·∫ßn ƒë·∫ßu th√¨ kh·ªüi t·∫°o
                PaginationUtils.init(tableId, {
                    pageSize: 9,
                    sortField: "id_category",
                    sortOrder: "asc",
                    visiblePages: 9,
                });

                PaginationUtils.setTotalItems(tableId, categories.length);

                const currentPageData = PaginationUtils.getPageData(tableId, categories);
                renderCategories(currentPageData);

                // Render l·∫°i ph√¢n trang v·ªõi style ph√π h·ª£p
                PaginationUtils.render(tableId, "categoryPagination", (state) => {
                    const pageData = PaginationUtils.getPageData(tableId, categories);
                    renderCategories(pageData);
                });

            } catch (error) {
                console.error("L·ªói khi t·∫£i danh s√°ch:", error);
                alert("L·ªói khi t·∫£i d·ªØ li·ªáu: " + error.message);
            }
        }
        // H√†m render danh m·ª•c t·ª´ d·ªØ li·ªáu ƒë√£ ph√¢n trang
        function renderCategories(categories) {
            const tableBody = document.getElementById("tbodyCategories");
            tableBody.innerHTML = ""; // X√≥a d·ªØ li·ªáu c≈©

            categories.forEach(category => {
                const isRootCategory = category.id_parent;
                const row = `<tr>
            <td>${category.id_category}</td>
            <td>${category.category_name}</td>
            <td>${category.alias_name || ""}</td>
            <td>${category.parent_category_name || ""}</td>
            <td class="actions-button">
                <button class="Cate-btn-edit" data-id="${category.id_category}" ${isRootCategory === null ? 'disabled' : ''}>
                    <i class="bi bi-pencil-square"></i> Ch·ªânh s·ª≠a
                </button>
                <button class="Cate-btn-delete" data-id="${category.id_category}" ${isRootCategory === null ? 'disabled' : ''}>
                    <i class="bi bi-trash"></i> X√≥a
                </button>
            </td>
        </tr>`;
                tableBody.innerHTML += row;
            });

            // G·∫Øn s·ª± ki·ªán cho n√∫t ch·ªânh s·ª≠a
            document.querySelectorAll(".Cate-btn-edit").forEach(button => {
                button.addEventListener("click", function () {
                    const categoryId = this.getAttribute("data-id");
                    openEditModal(categoryId);
                });
            });

            // G·∫Øn s·ª± ki·ªán cho n√∫t x√≥a
            document.querySelectorAll(".Cate-btn-delete:not([disabled])").forEach(button => {
                button.addEventListener("click", function () {
                    const categoryId = this.getAttribute("data-id");
                    showDeleteModal(categoryId);
                });
            });
        }
        // 2. H√†m hi·ªÉn th·ªã modal x√°c nh·∫≠n x√≥a
        function showDeleteModal(categoryId) {
            const modal = document.getElementById("deleteCategoryModal");
            console.log("Modal:", modal);

            const confirmBtn = document.getElementById("confirmDeleteCate");
            console.log("Confirm Button:", confirmBtn);

            const cancelBtn = document.getElementById("cancelDeleteCate");
            console.log("Cancel Button:", cancelBtn);

            console.log(categoryId);
            modal.style.display = "flex";

            // X·ª≠ l√Ω khi x√°c nh·∫≠n x√≥a
            confirmBtn.onclick = async function () {
                try {
                    const result = await deleteCategory(categoryId);
                    alert(result.message);
                    modal.style.display = "none";
                    if (result.success) {
                        fetchCategories(); // T·∫£i l·∫°i danh s√°ch
                    }
                } catch (error) {
                    alert("L·ªói khi x√≥a: " + (error.message || "L·ªói h·ªá th·ªëng"));
                    modal.style.display = "none";
                }
            };

            // X·ª≠ l√Ω khi h·ªßy
            cancelBtn.onclick = function () {
                modal.style.display = "none";
            };
        }

        // 3. H√†m x√≥a danh m·ª•c
        async function deleteCategory(categoryId) {
            try {
                const response = await fetch(`http://localhost:3000/api/categories/${categoryId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (!response.ok) {
                    // X·ª≠ l√Ω c√°c tr∆∞·ªùng h·ª£p l·ªói c·ª• th·ªÉ
                    if (data.error === 'CATEGORY_HAS_CHILDREN') {
                        return { success: false, message: "Kh√¥ng th·ªÉ x√≥a danh m·ª•c c√≥ ch·ª©a danh m·ª•c con" };
                    }
                    if (data.error === 'CATEGORY_HAS_ARTICLES') {
                        return { success: false, message: "Kh√¥ng th·ªÉ x√≥a danh m·ª•c c√≥ ch·ª©a b√†i vi·∫øt" };
                    }
                    if (data.error === 'ROOT_CATEGORY') {
                        return { success: false, message: "Kh√¥ng th·ªÉ x√≥a danh m·ª•c g·ªëc" };
                    }
                    return { success: false, message: data.message || "X√≥a th·∫•t b·∫°i" };
                }
                fetchCategories()
                return { success: true, message: "X√≥a th√†nh c√¥ng" };
            } catch (error) {
                console.error("L·ªói khi x√≥a:", error);
                throw error;
            }
        }

        // 4. H√†m th√™m danh m·ª•c m·ªõi
        async function addNewCategory(categoryData) {
            try {
                const response = await fetch('http://localhost:3000/api/categories', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(categoryData)
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || "Kh√¥ng th·ªÉ th√™m danh m·ª•c m·ªõi");
                }

                return result;
            } catch (error) {
                console.error("Error adding category:", error);
                throw error;
            }
        }

        // 5. H√†m c·∫≠p nh·∫≠t danh m·ª•c
        async function updateCategory(categoryId, updateData) {
            try {
                const response = await fetch(`http://localhost:3000/api/categories/${categoryId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();

                if (!response.ok) {
                    const errorMap = {
                        'CATEGORY_NOT_FOUND': 'Danh m·ª•c kh√¥ng t·ªìn t·∫°i',
                        'PARENT_CATEGORY_NOT_FOUND': 'Danh m·ª•c cha kh√¥ng t·ªìn t·∫°i',
                        'SERVER_ERROR': 'L·ªói h·ªá th·ªëng'
                    };
                    throw new Error(errorMap[result.error] || result.message || 'C·∫≠p nh·∫≠t th·∫•t b·∫°i');
                }

                return result;
            } catch (error) {
                console.error("Error updating category:", error);
                throw error;
            }
        }

        // 6. Kh·ªüi t·∫°o s·ª± ki·ªán cho form th√™m danh m·ª•c
        function initializeAddEvents2() {
            const addCategoryModal = document.getElementById("addCategoryModal");
            const addCategoryBtn = document.querySelector(".add-category-btn");
            const closeModalBtn = addCategoryModal.querySelector(".action-modal-close");
            const btnAdd = addCategoryModal.querySelector(".btn-add");

            // C√°c ph·∫ßn t·ª≠ form
            const addCategoryName = addCategoryModal.querySelector('input[type="text"]');
            const addLink = addCategoryModal.querySelector('input[placeholder="Nh·∫≠p link"]')
            const addParentCategory = document.getElementById("mainCategory2");

            // M·ªü modal
            addCategoryBtn.addEventListener("click", () => {
                addCategoryModal.style.display = "flex";
            });

            // ƒê√≥ng modal
            closeModalBtn.addEventListener("click", () => {
                addCategoryModal.style.display = "none";
            });

            // ƒê√≥ng khi click b√™n ngo√†i
            addCategoryModal.addEventListener("click", (e) => {
                if (e.target === addCategoryModal) {
                    addCategoryModal.style.display = "none";
                }
            });

            // X·ª≠ l√Ω th√™m danh m·ª•c m·ªõi
            btnAdd.addEventListener("click", async function () {
                if (!addCategoryName.value.trim()) {
                    alert("Vui l√≤ng ƒëi·ªÅn t√™n danh m·ª•c");
                    return;
                }

                if (!addParentCategory.value) {
                    alert("Vui l√≤ng ch·ªçn danh m·ª•c cha");
                    return;
                }
                console.log(addCategoryName.value.trim() + " " + addLink.value.trim() + " " + addParentCategory.value)
                const categoryData = {
                    category_name: addCategoryName.value.trim(),
                    link: addLink.value.trim(),
                    parent_category_name: addParentCategory.value
                };

                try {
                    await addNewCategory(categoryData);
                    alert("Th√™m danh m·ª•c m·ªõi th√†nh c√¥ng!");

                    // Reset form
                    addCategoryName.value = '';
                    addLink.value = '',
                        addParentCategory.value = '';

                    // ƒê√≥ng modal v√† t·∫£i l·∫°i danh s√°ch
                    addCategoryModal.style.display = "none";
                    fetchCategories();
                } catch (error) {
                    alert(`L·ªói: ${error.message}`);
                }
            });
        }

        // M·ªü modal ch·ªânh s·ª≠a v√† kh·ªüi t·∫°o d·ªØ li·ªáu
        function openEditModal(categoryId) {
            // T√¨m th√¥ng tin danh m·ª•c t·ª´ d·ªØ li·ªáu ƒë√£ l∆∞u
            const category = window.categoriesData.find(cat => cat.id_category === categoryId);
            if (!category) return;

            const isRootCategory = category.id_parent === null;
            console.log(isRootCategory);
            const editCategoryModal = document.getElementById("editCategoryModal");

            // ƒêi·ªÅn d·ªØ li·ªáu v√†o form ch·ªânh s·ª≠a
            document.getElementById("editCategoryName").value = category.category_name;
            document.getElementById("editCategoryLink").value = category.alias_name;


            // L·∫•y tr∆∞·ªùng link n·∫øu c√≥
            const linkInput = editCategoryModal.querySelector('input[placeholder="Nh·∫≠p link"]');
            if (linkInput && category.link) {
                linkInput.value = category.link;
            }

            // X·ª≠ l√Ω select box danh m·ª•c cha
            if (!isRootCategory) {
                const editParentCategory = document.getElementById("editParentCategory");
                editParentCategory.value = category.parent_category_name;
            }
            else {
                const editParentCategory = document.getElementById("editParentCategory");
                editParentCategory.value = "";
            }

            // Hi·ªÉn th·ªã modal
            editCategoryModal.style.display = "block";

            // L∆∞u categoryId v√† lo·∫°i danh m·ª•c v√†o thu·ªôc t√≠nh data c·ªßa modal
            editCategoryModal.dataset.categoryId = categoryId;
            editCategoryModal.dataset.isRoot = isRootCategory;

            // ƒê·∫£m b·∫£o event listener ch·ªâ ƒë∆∞·ª£c g·∫Øn m·ªôt l·∫ßn
            initializeEditEvents2();
        }
        // 7. Kh·ªüi t·∫°o s·ª± ki·ªán cho form ch·ªânh s·ª≠a danh m·ª•c
        function initializeEditEvents2() {
            const editCategoryModal = document.getElementById("editCategoryModal");
            const btnUpdateCategory = document.getElementById("btnUpdateCategory");
            const closeModalBtn = editCategoryModal.querySelector(".action-modal-close");

            // X√≥a event listeners c≈© ƒë·ªÉ tr√°nh duplicate
            const newCloseBtn = closeModalBtn.cloneNode(true);
            closeModalBtn.parentNode.replaceChild(newCloseBtn, closeModalBtn);

            const newUpdateBtn = btnUpdateCategory.cloneNode(true);
            btnUpdateCategory.parentNode.replaceChild(newUpdateBtn, btnUpdateCategory);

            // ƒê√≥ng modal ch·ªânh s·ª≠a
            newCloseBtn.addEventListener("click", function () {
                editCategoryModal.style.display = "none";
            });

            // X·ª≠ l√Ω c·∫≠p nh·∫≠t danh m·ª•c
            newUpdateBtn.addEventListener("click", async function () {
                const categoryId = editCategoryModal.dataset.categoryId;
                const isRootCategory = editCategoryModal.dataset.isRoot === "true";
                const editCategoryName = document.getElementById("editCategoryName").value.trim();
                const linkInput = document.getElementById("editCategoryLink");
                const link = linkInput ? linkInput.value : "";
                if (!editCategoryName) {
                    alert("Vui l√≤ng ƒëi·ªÅn t√™n danh m·ª•c");
                    return;
                }
                console.log(isRootCategory);
                // L·∫•y parent_id ch·ªâ khi kh√¥ng ph·∫£i danh m·ª•c g·ªëc
                let updateData;
                if (isRootCategory) {
                    // N·∫øu l√† danh m·ª•c g·ªëc, gi·ªØ nguy√™n parent_id l√† null
                    updateData = {
                        category_name: editCategoryName,
                        link: link,
                        parent_category_name: ""
                    };
                } else {
                    const editParentCategory = document.getElementById("editParentCategory");
                    if (editParentCategory && !editParentCategory.value) {
                        alert("Vui l√≤ng ch·ªçn danh m·ª•c cha");
                        return;
                    }
                    updateData = {
                        category_name: editCategoryName,
                        link: link,
                        parent_category_name: editParentCategory ? editParentCategory.value : null
                    };
                }

                try {
                    await updateCategory(categoryId, updateData);
                    alert("C·∫≠p nh·∫≠t danh m·ª•c th√†nh c√¥ng!");
                    editCategoryModal.style.display = "none";
                    fetchCategories();
                } catch (error) {
                    alert(`L·ªói: ${error.message}`);
                }
            });
        }

        // Thay ƒë·ªïi ƒëo·∫°n code t·∫°o container ph√¢n trang nh∆∞ sau:
        document.addEventListener("DOMContentLoaded", function () {
            initializeAddEvents2();
            initializeEditEvents2();

            // T·∫°o container cho ph√¢n trang n·∫øu ch∆∞a c√≥
            if (!document.getElementById("categoryPagination")) {
                const paginationContainer = document.createElement("div");
                paginationContainer.id = "categoryPagination";

                // Th√™m v√†o sau b·∫£ng - ch·ªçn ƒë√∫ng b·∫£ng danh m·ª•c
                const categoryTable = document.querySelectorAll("table")[1];
                categoryTable.parentNode.insertBefore(paginationContainer, categoryTable.nextSibling);
            }

            fetchCategories();
        });


        async function fetchUser() {
            const response = await fetch("http://localhost:3000/api/users");
            const users = await response.json();

            const tableBody = document.getElementById("tbodyUser");
            tableBody.innerHTML = ""; // X√≥a d·ªØ li·ªáu c≈©

            users.forEach(user => {
                const row = `<tr>
              <td>${user.id_user}</td>
              <td>${user.username}</td>
              <td>${user.email}</td>
              <td>${user.password}</td>
              <td>
                <div class="user-actions">
                    <button class="User-btn-delete"><i class="bi bi-trash"></i> X√≥a</button>
                    <div class="toggle-switch">
                        <input type="checkbox" id="userToggle1" class="toggle-input" checked>
                        <label for="userToggle1" class="toggle-label"></label>
                    </div>
                </div>
             </td>
            </tr>`;
                tableBody.innerHTML += row;
            });
        }
        fetchUser();
        fetchCategories();
        fetchArticles();

    </script>
    <script src="../js/admin.js"></script>
</body>

</html>